<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#00897b">
    <link rel="manifest" href="manifest.json">
    <title>Sawt Al Quran - ØµÙˆØª Ø§Ù„Ù‚Ø±Ø¢Ù†</title>
    <style>
        /* Previous CSS remains exactly the same */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e0f2f1 0%, #b2dfdb 100%);
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #00897b 0%, #00695c 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 900px;
            margin: 0 auto;
        }

        .header-title {
            text-align: center;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header h2 {
            font-size: 16px;
            font-weight: normal;
            opacity: 0.9;
        }

        .header-controls {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 10px;
        }

        .header-controls select,
        .header-controls input {
            width: 100%;
            padding: 10px 8px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            font-size: 14px;
            outline: none;
            background: rgba(255,255,255,0.95);
        }

        .header-controls select:focus,
        .header-controls input:focus {
            border-color: white;
        }

        @media (max-width: 768px) {
            .header-controls {
                grid-template-columns: 1fr 1fr 1fr 1fr;
                gap: 8px;
            }
            
            .header-controls select,
            .header-controls input {
                padding: 8px 6px;
                font-size: 12px;
            }
        }

        @media (max-width: 480px) {
            .header-controls {
                grid-template-columns: 1fr 1fr;
                gap: 6px;
            }
            
            .header-controls select,
            .header-controls input {
                padding: 8px 4px;
                font-size: 11px;
            }
        }

        /* Rest of the CSS remains exactly the same */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .player {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: none;
        }

        .player.active {
            display: block;
        }

        .player-info {
            text-align: center;
            margin-bottom: 20px;
        }

        .player-info h3 {
            font-size: 28px;
            color: #00695c;
            margin-bottom: 8px;
        }

        .player-info p {
            color: #666;
            margin-bottom: 4px;
        }

        .current-qari {
            background: #e0f2f1;
            padding: 8px 16px;
            border-radius: 20px;
            display: inline-block;
            margin-top: 8px;
            font-size: 14px;
            color: #00695c;
            font-weight: bold;
        }

        .progress-container {
            background: #e0e0e0;
            height: 8px;
            border-radius: 4px;
            margin-bottom: 8px;
            cursor: pointer;
            overflow: hidden;
        }

        .progress-bar {
            background: #00897b;
            height: 100%;
            width: 0%;
            border-radius: 4px;
            transition: width 0.1s;
        }

        .time-display {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #666;
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }

        .control-btn {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            background: #e0f2f1;
            color: #00897b;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .control-btn:hover {
            background: #b2dfdb;
            transform: scale(1.05);
        }

        .control-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .control-btn.play-btn {
            width: 60px;
            height: 60px;
            background: #00897b;
            color: white;
        }

        .control-btn.play-btn:hover {
            background: #00695c;
        }

        .surah-list {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .surah-item {
            padding: 15px 20px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background 0.2s;
        }

        .surah-item:hover {
            background: #e0f2f1;
        }

        .surah-item.active {
            background: #e0f2f1;
        }

        .surah-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }

        .surah-number {
            width: 40px;
            height: 40px;
            background: #00897b;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }

        .surah-names {
            flex: 1;
        }

        .surah-names h3 {
            font-size: 18px;
            color: #333;
            margin-bottom: 4px;
        }

        .surah-names p {
            font-size: 13px;
            color: #666;
        }

        .surah-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .play-action {
            background: #e0f2f1;
            color: #00897b;
        }

        .play-action:hover {
            background: #b2dfdb;
        }

        .download-action {
            background: #e3f2fd;
            color: #1976d2;
        }

        .download-action:hover {
            background: #bbdefb;
        }

        .footer {
            background: #00695c;
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 30px;
        }

        .footer p {
            margin-bottom: 5px;
        }

        .list-container {
            max-height: 500px;
            overflow-y: auto;
        }

        .list-container::-webkit-scrollbar {
            width: 8px;
        }

        .list-container::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .list-container::-webkit-scrollbar-thumb {
            background: #00897b;
            border-radius: 4px;
        }

        .list-container::-webkit-scrollbar-thumb:hover {
            background: #00695c;
        }

        svg {
            width: 20px;
            height: 20px;
        }

        .scroll-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            background: #00897b;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            transition: all 0.3s;
        }

        .scroll-to-top:hover {
            background: #00695c;
            transform: scale(1.1);
        }

        .scroll-to-top.show {
            display: flex;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="header-title">
                <h1 id="mainTitle">ØµÙˆØª Ø§Ù„Ù‚Ø±Ø¢Ù† - Sawt Al Quran</h1>
                <h2 id="subTitle">Complete Quran Audio Collection</h2>
            </div>
            <div class="header-controls">
                <select id="languageSelect">
                    <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                    <option value="ar">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                    <option value="bn">ğŸ‡§ğŸ‡© à¦¬à¦¾à¦‚à¦²à¦¾</option>
                    <option value="ur">ğŸ‡µğŸ‡° Ø§Ø±Ø¯Ùˆ</option>
                </select>
                <select id="countrySelect">
                    <option value="">ğŸŒ All Countries</option>
                    <option value="saudi">ğŸ‡¸ğŸ‡¦ Saudi Arabia</option>
                    <option value="egypt">ğŸ‡ªğŸ‡¬ Egypt</option>
                    <option value="morocco">ğŸ‡²ğŸ‡¦ Morocco</option>
                    <option value="sudan">ğŸ‡¸ğŸ‡© Sudan</option>
                    <option value="iraq">ğŸ‡®ğŸ‡¶ Iraq</option>
                    <option value="syria">ğŸ‡¸ğŸ‡¾ Syria</option>
                    <option value="yemen">ğŸ‡¾ğŸ‡ª Yemen</option>
                    <option value="kuwait">ğŸ‡°ğŸ‡¼ Kuwait</option>
                    <option value="libya">ğŸ‡±ğŸ‡¾ Libya</option>
                    <option value="algeria">ğŸ‡©ğŸ‡¿ Algeria</option>
                    <option value="somalia">ğŸ‡¸ğŸ‡´ Somalia</option>
                    <option value="turkey">ğŸ‡¹ğŸ‡· Turkey</option>
                    <option value="bahrain">ğŸ‡§ğŸ‡­ Bahrain</option>
                    <option value="uae">ğŸ‡¦ğŸ‡ª UAE</option>
                    <option value="jordan">ğŸ‡¯ğŸ‡´ Jordan</option>
                    <option value="lebanon">ğŸ‡±ğŸ‡§ Lebanon</option>
                    <option value="iran">ğŸ‡®ğŸ‡· Iran</option>
                    <option value="qatar">ğŸ‡¶ğŸ‡¦ Qatar</option>
                    <option value="pakistan">ğŸ‡µğŸ‡° Pakistan</option>
                    <option value="palestine">ğŸ‡µğŸ‡¸ Palestine</option>
                    <option value="senegal">ğŸ‡¸ğŸ‡³ Senegal</option>
                </select>
                <select id="qariSelect">
                    <option value="abdul_mohsen_al_harthy">Abdul Mohsen Al Harthy</option>
                    <option value="abdul_rahman_al_sudais">Abdul Rahman Al-Sudais</option>
                    <option value="saad_al_ghamdi">Saad Al-Ghamdi</option>
                    <option value="maher_al_muaiqly">Maher Al-Muaiqly</option>
                    <option value="saud_al_shuraim">Saud Al-Shuraim</option>
                    <option value="abdullah_basfar">Abdullah Basfar</option>
                    <option value="mohammad_ayyub">Mohammad Ayyub</option>
                    <option value="yasser_al_dosari">Yasser Al-Dosari</option>
                </select>
                <input type="text" id="searchInput" placeholder="Search Surah...">
            </div>
        </div>
    </div>

    <div class="container">
        <div class="player" id="player">
            <div class="player-info">
                <h3 id="currentSurahArabic"></h3>
                <p id="currentSurahEnglish"></p>
                <p id="currentSurahDetails"></p>
                <span class="current-qari" id="currentQari"></span>
            </div>

            <div class="progress-container" id="progressContainer">
                <div class="progress-bar" id="progressBar"></div>
            </div>

            <div class="time-display">
                <span id="currentTime">0:00</span>
                <span id="duration">0:00</span>
            </div>

            <div class="controls">
                <button class="control-btn" id="prevBtn">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/>
                    </svg>
                </button>

                <button class="control-btn play-btn" id="playBtn">
                    <svg id="playIcon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M8 5v14l11-7z"/>
                    </svg>
                    <svg id="pauseIcon" viewBox="0 0 24 24" fill="currentColor" style="display:none;">
                        <path d="M6 4h4v16H6zm8 0h4v16h-4z"/>
                    </svg>
                </button>

                <button class="control-btn" id="nextBtn">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M16 18h2V6h-2zm-11-1l8.5-6L6 5z"/>
                    </svg>
                </button>
            </div>
        </div>

        <div class="surah-list">
            <div class="list-container" id="surahList"></div>
        </div>
    </div>

    <div class="footer">
        <p id="footerText1">Sawt Al Quran - Complete Quran Audio Collection</p>
        <p id="footerText2" style="font-size: 12px; opacity: 0.9;">Made with Love for the Ummah</p>
    </div>

    <button class="scroll-to-top" id="scrollToTop">
        <svg viewBox="0 0 24 24" fill="currentColor" style="width: 24px; height: 24px;">
            <path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/>
        </svg>
    </button>

    <audio id="audioPlayer"></audio>

    <script>
        // Language translations object
        const translations = {
            en: {
                title: "Sawt Al Quran - ØµÙˆØª Ø§Ù„Ù‚Ø±Ø¢Ù†",
                subtitle: "Complete Quran Audio Collection",
                searchPlaceholder: "Search Surah...",
                selectQari: "Select Qari",
                allCountries: "ğŸŒ All Countries",
                surah: "Surah",
                verses: "Verses",
                qari: "Qari",
                footer1: "Sawt Al Quran - Complete Quran Audio Collection",
                footer2: "Made with Love for the Ummah",
                play: "Play",
                download: "Download",
                currentTime: "Current Time",
                totalTime: "Total Time"
            },
            ar: {
                title: "ØµÙˆØª Ø§Ù„Ù‚Ø±Ø¢Ù†",
                subtitle: "Ù…Ø¬Ù…ÙˆØ¹Ø© ÙƒØ§Ù…Ù„Ø© Ù„ØªÙ„Ø§ÙˆØ§Øª Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…",
                searchPlaceholder: "Ø§Ø¨Ø­Ø« Ø¹Ù† Ø³ÙˆØ±Ø©...",
                selectQari: "Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø§Ø±Ø¦",
                allCountries: "ğŸŒ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙˆÙ„",
                surah: "Ø³ÙˆØ±Ø©",
                verses: "Ø¢ÙŠØ©",
                qari: "Ø§Ù„Ù‚Ø§Ø±Ø¦",
                footer1: "ØµÙˆØª Ø§Ù„Ù‚Ø±Ø¢Ù† - Ù…Ø¬Ù…ÙˆØ¹Ø© ÙƒØ§Ù…Ù„Ø© Ù„ØªÙ„Ø§ÙˆØ§Øª Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…",
                footer2: "ØµÙ†Ø¹ Ø¨Ø­Ø¨ Ù„Ù„Ø£Ù…Ø©",
                play: "ØªØ´ØºÙŠÙ„",
                download: "ØªØ­Ù…ÙŠÙ„",
                currentTime: "Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ",
                totalTime: "Ø§Ù„ÙˆÙ‚Øª Ø§Ù„ÙƒÙ„ÙŠ"
            },
            bn: {
                title: "à¦¸à¦¾à¦“à¦¤à§à¦² à¦•à§à¦°à¦†à¦¨ - ØµÙˆØª Ø§Ù„Ù‚Ø±Ø¢Ù†",
                subtitle: "à¦¸à¦®à§à¦ªà§‚à¦°à§à¦£ à¦•à§à¦°à¦†à¦¨ à¦…à¦¡à¦¿à¦“ à¦¸à¦‚à¦—à§à¦°à¦¹",
                searchPlaceholder: "à¦¸à§‚à¦°à¦¾ à¦–à§à¦à¦œà§à¦¨...",
                selectQari: "à¦•à§à¦¬à¦¾à¦°à¦¿ à¦¨à¦¿à¦°à§à¦¬à¦¾à¦šà¦¨ à¦•à¦°à§à¦¨",
                allCountries: "ğŸŒ à¦¸à¦•à¦² à¦¦à§‡à¦¶",
                surah: "à¦¸à§‚à¦°à¦¾",
                verses: "à¦†à§Ÿà¦¾à¦¤",
                qari: "à¦•à§à¦¬à¦¾à¦°à¦¿",
                footer1: "à¦¸à¦¾à¦“à¦¤à§à¦² à¦•à§à¦°à¦†à¦¨ - à¦¸à¦®à§à¦ªà§‚à¦°à§à¦£ à¦•à§à¦°à¦†à¦¨ à¦…à¦¡à¦¿à¦“ à¦¸à¦‚à¦—à§à¦°à¦¹",
                footer2: "à¦‰à¦®à§à¦®à¦¾à¦¹à¦° à¦œà¦¨à§à¦¯ à¦­à¦¾à¦²à§‹à¦¬à¦¾à¦¸à¦¾ à¦¨à¦¿à§Ÿà§‡ à¦¤à§ˆà¦°à¦¿",
                play: "à¦šà¦¾à¦²à¦¾à¦¨",
                download: "à¦¡à¦¾à¦‰à¦¨à¦²à§‹à¦¡",
                currentTime: "à¦¬à¦°à§à¦¤à¦®à¦¾à¦¨ à¦¸à¦®à¦¯à¦¼",
                totalTime: "à¦®à§‹à¦Ÿ à¦¸à¦®à¦¯à¦¼"
            },
            ur: {
                title: "ØµÙˆØª Ø§Ù„Ù‚Ø±Ø¢Ù† - Ø³Ø§ÙˆØª Ø§Ù„Ù‚Ø±Ø¢Ù†",
                subtitle: "Ù…Ú©Ù…Ù„ Ù‚Ø±Ø¢Ù† Ø¢ÚˆÛŒÙˆ Ù…Ø¬Ù…ÙˆØ¹Û",
                searchPlaceholder: "Ø³ÙˆØ±Øª ØªÙ„Ø§Ø´ Ú©Ø±ÛŒÚº...",
                selectQari: "Ù‚Ø§Ø±ÛŒ Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº",
                allCountries: "ğŸŒ ØªÙ…Ø§Ù… Ù…Ù…Ø§Ù„Ú©",
                surah: "Ø³ÙˆØ±Øª",
                verses: "Ø¢ÛŒØ§Øª",
                qari: "Ù‚Ø§Ø±ÛŒ",
                footer1: "ØµÙˆØª Ø§Ù„Ù‚Ø±Ø¢Ù† - Ù…Ú©Ù…Ù„ Ù‚Ø±Ø¢Ù† Ø¢ÚˆÛŒÙˆ Ù…Ø¬Ù…ÙˆØ¹Û",
                footer2: "Ø§Ù…Øª Ú©Û’ Ù„ÛŒÛ’ Ù…Ø­Ø¨Øª Ø³Û’ Ø¨Ù†Ø§ÛŒØ§ Ú¯ÛŒØ§",
                play: "Ú†Ù„Ø§Ø¦ÛŒÚº",
                download: "ÚˆØ§Ø¤Ù† Ù„ÙˆÚˆ",
                currentTime: "Ù…ÙˆØ¬ÙˆØ¯Û ÙˆÙ‚Øª",
                totalTime: "Ú©Ù„ ÙˆÙ‚Øª"
            }
        };

        var surahs = [
            { number: 1, arabic: "Ø§Ù„ÙØ§ØªØ­Ø©", english: "Al-Fatihah", verses: 7 },
            { number: 2, arabic: "Ø§Ù„Ø¨Ù‚Ø±Ø©", english: "Al-Baqarah", verses: 286 },
            // ... rest of the surahs array remains exactly the same
            { number: 114, arabic: "Ø§Ù„Ù†Ø§Ø³", english: "An-Nas", verses: 6 }
        ];

        var qaris = {
            // ... qaris object remains exactly the same
        };

        var currentSurah = null;
        var isPlaying = false;
        var currentQari = 'abdul_mohsen_al_harthy';
        var currentLanguage = 'en'; // Default language
        var audio = document.getElementById('audioPlayer');
        var player = document.getElementById('player');
        var playBtn = document.getElementById('playBtn');
        var playIcon = document.getElementById('playIcon');
        var pauseIcon = document.getElementById('pauseIcon');
        var progressBar = document.getElementById('progressBar');
        var progressContainer = document.getElementById('progressContainer');
        var currentTimeEl = document.getElementById('currentTime');
        var durationEl = document.getElementById('duration');
        var searchInput = document.getElementById('searchInput');
        var prevBtn = document.getElementById('prevBtn');
        var nextBtn = document.getElementById('nextBtn');
        var qariSelect = document.getElementById('qariSelect');
        var countrySelect = document.getElementById('countrySelect');
        var languageSelect = document.getElementById('languageSelect');
        var scrollToTopBtn = document.getElementById('scrollToTop');

        function changeLanguage(lang) {
            currentLanguage = lang;
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
            
            // Update all text elements
            document.getElementById('mainTitle').textContent = translations[lang].title;
            document.getElementById('subTitle').textContent = translations[lang].subtitle;
            document.getElementById('searchInput').placeholder = translations[lang].searchPlaceholder;
            document.getElementById('footerText1').textContent = translations[lang].footer1;
            document.getElementById('footerText2').textContent = translations[lang].footer2;
            
            // Update country select
            var allCountriesOption = countrySelect.querySelector('option[value=""]');
            if (allCountriesOption) {
                allCountriesOption.textContent = translations[lang].allCountries;
            }
            
            // Update player details if a surah is playing
            if (currentSurah) {
                updatePlayerUI(currentSurah);
            }
            
            // Re-render surah list with updated language
            renderSurahs(surahs);
        }

        function filterQarisByCountry(country) {
            var qariSelectEl = document.getElementById('qariSelect');
            qariSelectEl.innerHTML = '';
            
            var defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.textContent = translations[currentLanguage].selectQari;
            qariSelectEl.appendChild(defaultOption);
            
            for (var key in qaris) {
                var qari = qaris[key];
                if (country === '' || qari.country === country) {
                    var option = document.createElement('option');
                    option.value = key;
                    option.textContent = qari.name;
                    qariSelectEl.appendChild(option);
                }
            }
            
            // Set default selection for Saudi Arabia (first Qari)
            if (country === 'saudi') {
                qariSelectEl.value = 'abdul_mohsen_al_harthy';
                currentQari = 'abdul_mohsen_al_harthy';
            } else if (qariSelectEl.options.length > 1) {
                qariSelectEl.value = qariSelectEl.options[1].value;
                currentQari = qariSelectEl.value;
            }
            
            if (currentSurah) {
                audio.src = getAudioUrl(currentSurah.number);
                updatePlayerUI(currentSurah);
            }
        }

        function getAudioUrl(surahNumber) {
            var paddedNumber = String(surahNumber).padStart(3, '0');
            var qari = qaris[currentQari];
            
            if (!qari) return '';
            
            // Check if it's a direct URL (starts with http)
            if (qari.server.startsWith('http')) {
                // Direct URL format (like archive.org)
                if (qari.folder) {
                    return qari.server + '/' + qari.folder + '/' + paddedNumber + '.mp3';
                } else {
                    return qari.server + '/' + paddedNumber + '.mp3';
                }
            } else {
                // Standard server format (like server8.mp3quran.net)
                return 'https://' + qari.server + '.mp3quran.net/' + qari.folder + '/' + paddedNumber + '.mp3';
            }
        }

        function formatTime(seconds) {
            if (!seconds || isNaN(seconds)) return '0:00';
            var mins = Math.floor(seconds / 60);
            var secs = Math.floor(seconds % 60);
            return mins + ':' + (secs < 10 ? '0' : '') + secs;
        }

        function updatePlayerUI(surah) {
            document.getElementById('currentSurahArabic').textContent = surah.arabic;
            document.getElementById('currentSurahEnglish').textContent = surah.english;
            
            var detailsText = translations[currentLanguage].surah + ' ' + surah.number + ' - ' + surah.verses + ' ' + translations[currentLanguage].verses;
            document.getElementById('currentSurahDetails').textContent = detailsText;
            
            var qariText = translations[currentLanguage].qari + ': ' + qaris[currentQari].name;
            document.getElementById('currentQari').textContent = qariText;
            
            player.classList.add('active');
        }

        function playSurah(surah) {
            if (!currentQari || currentQari === '') {
                alert('Please select a Qari first');
                return;
            }
            
            if (currentSurah && currentSurah.number === surah.number && isPlaying) {
                audio.pause();
                isPlaying = false;
                updatePlayButton();
            } else {
                if (!currentSurah || currentSurah.number !== surah.number) {
                    currentSurah = surah;
                    audio.src = getAudioUrl(surah.number);
                    updatePlayerUI(surah);
                }
                audio.play();
                isPlaying = true;
                updatePlayButton();
            }
            updateActiveItem();
        }

        function togglePlay() {
            if (currentSurah) {
                playSurah(currentSurah);
            }
        }

        function playNext() {
            if (currentSurah && currentSurah.number < 114) {
                var nextSurah = surahs[currentSurah.number];
                currentSurah = nextSurah;
                audio.src = getAudioUrl(nextSurah.number);
                audio.play();
                isPlaying = true;
                updatePlayerUI(nextSurah);
                updatePlayButton();
                updateActiveItem();
            }
        }

        function playPrevious() {
            if (currentSurah && currentSurah.number > 1) {
                var prevSurah = surahs[currentSurah.number - 2];
                currentSurah = prevSurah;
                audio.src = getAudioUrl(prevSurah.number);
                audio.play();
                isPlaying = true;
                updatePlayerUI(prevSurah);
                updatePlayButton();
                updateActiveItem();
            }
        }

        function updatePlayButton() {
            if (isPlaying) {
                playIcon.style.display = 'none';
                pauseIcon.style.display = 'block';
            } else {
                playIcon.style.display = 'block';
                pauseIcon.style.display = 'none';
            }
        }

        function updateActiveItem() {
            var items = document.querySelectorAll('.surah-item');
            for (var i = 0; i < items.length; i++) {
                items[i].classList.remove('active');
            }
            if (currentSurah) {
                var activeItem = document.querySelector('[data-surah="' + currentSurah.number + '"]');
                if (activeItem) {
                    activeItem.classList.add('active');
                }
            }
        }

        function downloadSurah(surah) {
            if (!currentQari || currentQari === '') {
                alert('Please select a Qari first');
                return;
            }
            
            var url = getAudioUrl(surah.number);
            var a = document.createElement('a');
            a.href = url;
            a.download = surah.number + '-' + surah.english + '-' + qaris[currentQari].name + '.mp3';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        function renderSurahs(filteredSurahs) {
            var surahList = document.getElementById('surahList');
            surahList.innerHTML = '';

            for (var i = 0; i < filteredSurahs.length; i++) {
                var surah = filteredSurahs[i];
                var item = document.createElement('div');
                item.className = 'surah-item';
                item.setAttribute('data-surah', surah.number);
                item.setAttribute('data-index', i);
                
                var surahText = translations[currentLanguage].surah + ' ' + surah.number + ' - ' + surah.verses + ' ' + translations[currentLanguage].verses;
                
                item.innerHTML = '<div class="surah-info">' +
                    '<div class="surah-number">' + surah.number + '</div>' +
                    '<div class="surah-names">' +
                    '<h3>' + surah.arabic + '</h3>' +
                    '<p>' + surah.english + ' - ' + surahText + '</p>' +
                    '</div>' +
                    '</div>' +
                    '<div class="surah-actions">' +
                    '<button class="action-btn play-action" data-action="play" data-surah-num="' + surah.number + '" title="' + translations[currentLanguage].play + '">' +
                    '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>' +
                    '</button>' +
                    '<button class="action-btn download-action" data-action="download" data-surah-num="' + surah.number + '" title="' + translations[currentLanguage].download + '">' +
                    '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>' +
                    '</button>' +
                    '</div>';
                
                surahList.appendChild(item);
            }
        }

        // Event Listeners
        languageSelect.addEventListener('change', function() {
            changeLanguage(languageSelect.value);
        });

        countrySelect.addEventListener('change', function() {
            filterQarisByCountry(countrySelect.value);
        });

        qariSelect.addEventListener('change', function() {
            currentQari = qariSelect.value;
            if (currentSurah) {
                audio.src = getAudioUrl(currentSurah.number);
                if (isPlaying) {
                    audio.play();
                }
                updatePlayerUI(currentSurah);
            }
        });

        window.addEventListener('scroll', function() {
            if (window.pageYOffset > 300) {
                scrollToTopBtn.classList.add('show');
            } else {
                scrollToTopBtn.classList.remove('show');
            }
        });

        scrollToTopBtn.addEventListener('click', function() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

        document.addEventListener('click', function(e) {
            var target = e.target;
            while (target && !target.hasAttribute('data-action')) {
                target = target.parentElement;
            }
            
            if (target) {
                var action = target.getAttribute('data-action');
                var surahNum = parseInt(target.getAttribute('data-surah-num'));
                var surah = surahs[surahNum - 1];
                
                if (action === 'play') {
                    playSurah(surah);
                } else if (action === 'download') {
                    downloadSurah(surah);
                }
            }
        });

        playBtn.addEventListener('click', togglePlay);
        prevBtn.addEventListener('click', playPrevious);
        nextBtn.addEventListener('click', playNext);

        audio.addEventListener('timeupdate', function() {
            if (audio.duration) {
                var progress = (audio.currentTime / audio.duration) * 100;
                progressBar.style.width = progress + '%';
                currentTimeEl.textContent = formatTime(audio.currentTime);
                durationEl.textContent = formatTime(audio.duration);
            }
        });

        audio.addEventListener('ended', function() {
            isPlaying = false;
            updatePlayButton();
            playNext();
        });

        audio.addEventListener('loadedmetadata', function() {
            durationEl.textContent = formatTime(audio.duration);
        });

        progressContainer.addEventListener('click', function(e) {
            var rect = progressContainer.getBoundingClientRect();
            var percent = (e.clientX - rect.left) / rect.width;
            audio.currentTime = percent * audio.duration;
        });

        searchInput.addEventListener('input', function(e) {
            var term = e.target.value.toLowerCase();
            var filtered = surahs.filter(function(surah) {
                return surah.arabic.includes(term) ||
                    surah.english.toLowerCase().includes(term) ||
                    surah.number.toString().includes(term);
            });
            renderSurahs(filtered);
        });

        // Initialize
        changeLanguage('en'); // Set default language to English
        filterQarisByCountry('');
        renderSurahs(surahs);

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('service-worker.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registered');
                    })
                    .catch(function(err) {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>
</body>
</html>
