<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#00897b">
    <link rel="manifest" href="manifest.json">
    <title>Sawt Al Quran - صوت القرآن</title>
    <style>
        /* CSS styles (same as provided above) */
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="header-title">
                <h1>صوت القرآن - Sawt Al Quran</h1>
                <h2>Complete Quran Audio Collection</h2>
            </div>
            <div class="header-controls">
                <select id="qariSelect">
                    <option value="yasser_ad-dussary">Yasser Al-Dosari (ياسر الدوسري)</option>
                    <!-- other qaris can be added here if needed -->
                </select>
                <input type="text" id="searchInput" placeholder="Search Surah by name or number...">
            </div>
        </div>
    </div>

    <div class="container">
        <div class="player" id="player">
            <div class="player-info">
                <h3 id="currentSurahArabic"></h3>
                <p id="currentSurahEnglish"></p>
                <p id="currentSurahDetails"></p>
                <span class="current-qari" id="currentQari"></span>
            </div>

            <div class="progress-container" id="progressContainer">
                <div class="progress-bar" id="progressBar"></div>
            </div>

            <div class="time-display">
                <span id="currentTime">0:00</span>
                <span id="duration">0:00</span>
            </div>

            <div class="controls">
                <button class="control-btn" id="prevBtn">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/>
                    </svg>
                </button>

                <button class="control-btn play-btn" id="playBtn">
                    <svg id="playIcon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M8 5v14l11-7z"/>
                    </svg>
                    <svg id="pauseIcon" viewBox="0 0 24 24" fill="currentColor" style="display:none;">
                        <path d="M6 4h4v16H6zm8 0h4v16h-4z"/>
                    </svg>
                </button>

                <button class="control-btn" id="nextBtn">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M16 18h2V6h-2zm-11-1l8.5-6L6 5z"/>
                    </svg>
                </button>
            </div>
        </div>

        <div class="surah-list">
            <div class="list-container" id="surahList"></div>
        </div>
    </div>

    <div class="footer">
        <p>Sawt Al Quran - Complete Quran Audio Collection</p>
        <p style="font-size: 12px; opacity: 0.9;">Made with Love for the Ummah</p>
    </div>

    <button class="scroll-to-top" id="scrollToTop">
        <svg viewBox="0 0 24 24" fill="currentColor" style="width: 24px; height: 24px;">
            <path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/>
        </svg>
    </button>

    <audio id="audioPlayer"></audio>

    <script>
        var surahs = [
            { number: 1, arabic: "الفاتحة", english: "Al-Fatihah", verses: 7 },
            { number: 2, arabic: "البقرة", english: "Al-Baqarah", verses: 286 },
            { number: 3, arabic: "آل عمران", english: "Aali Imran", verses: 200 },
            { number: 4, arabic: "النساء", english: "An-Nisa", verses: 176 },
            { number: 5, arabic: "المائدة", english: "Al-Ma'idah", verses: 120 },
            { number: 6, arabic: "الأنعام", english: "Al-An'am", verses: 165 },
            { number: 7, arabic: "الأعراف", english: "Al-A'raf", verses: 206 },
            { number: 8, arabic: "الأنفال", english: "Al-Anfal", verses: 75 },
            { number: 9, arabic: "التوبة", english: "At-Tawbah", verses: 129 },
            { number: 10, arabic: "يونس", english: "Yunus", verses: 109 },
            // Add all the surahs here...
        ];

        var qaris = {
            'yasser_ad-dussary': { name: 'Yasser Al-Dosari', server: 'server11', folder: 'yasser' }
        };

        var currentSurah = null;
        var isPlaying = false;
        var currentQari = 'yasser_ad-dussary';
        var audio = document.getElementById('audioPlayer');
        var player = document.getElementById('player');
        var playBtn = document.getElementById('playBtn');
        var playIcon = document.getElementById('playIcon');
        var pauseIcon = document.getElementById('pauseIcon');
        var progressBar = document.getElementById('progressBar');
        var progressContainer = document.getElementById('progressContainer');
        var currentTimeEl = document.getElementById('currentTime');
        var durationEl = document.getElementById('duration');
        var searchInput = document.getElementById('searchInput');
        var prevBtn = document.getElementById('prevBtn');
        var nextBtn = document.getElementById('nextBtn');
        var qariSelect = document.getElementById('qariSelect');
        var scrollToTopBtn = document.getElementById('scrollToTop');

        window.addEventListener('scroll', function() {
            if (window.pageYOffset > 300) {
                scrollToTopBtn.classList.add('show');
            } else {
                scrollToTopBtn.classList.remove('show');
            }
        });

        scrollToTopBtn.addEventListener('click', function() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

        function getAudioUrl(surahNumber) {
            var paddedNumber = String(surahNumber).padStart(3, '0');
            return 'https://server11.mp3quran.net/yasser/' + paddedNumber + '.mp3';
        }

        function formatTime(seconds) {
            if (!seconds || isNaN(seconds)) return '0:00';
            var mins = Math.floor(seconds / 60);
            var secs = Math.floor(seconds % 60);
            return mins + ':' + (secs < 10 ? '0' : '') + secs;
        }

        function updatePlayerUI(surah) {
            document.getElementById('currentSurahArabic').textContent = surah.arabic;
            document.getElementById('currentSurahEnglish').textContent = surah.english;
            document.getElementById('currentSurahDetails').textContent = 'Surah ' + surah.number + ' - ' + surah.verses + ' Verses';
            document.getElementById('currentQari').textContent = 'Qari: ' + qaris[currentQari].name;
            player.classList.add('active');
        }

        function playSurah(surah) {
            if (currentSurah && currentSurah.number === surah.number && isPlaying) {
                audio.pause();
                isPlaying = false;
                updatePlayButton();
            } else {
                if (!currentSurah || currentSurah.number !== surah.number) {
                    currentSurah = surah;
                    audio.src = getAudioUrl(surah.number);
                    updatePlayerUI(surah);
                }
                audio.play();
                isPlaying = true;
                updatePlayButton();
            }
            updateActiveItem();
        }

        function togglePlay() {
            if (currentSurah) {
                playSurah(currentSurah);
            }
        }

        function playNext() {
            if (currentSurah && currentSurah.number < 114) {
                var nextSurah = surahs[currentSurah.number];
                currentSurah = nextSurah;
                audio.src = getAudioUrl(nextSurah.number);
                audio.play();
                isPlaying = true;
                updatePlayerUI(nextSurah);
                updatePlayButton();
                updateActiveItem();
            }
        }

        function playPrevious() {
            if (currentSurah && currentSurah.number > 1) {
                var prevSurah = surahs[currentSurah.number - 2];
                currentSurah = prevSurah;
                audio.src = getAudioUrl(prevSurah.number);
                audio.play();
                isPlaying = true;
                updatePlayerUI(prevSurah);
                updatePlayButton();
                updateActiveItem();
            }
        }

        function updatePlayButton() {
            if (isPlaying) {
                playIcon.style.display = 'none';
                pauseIcon.style.display = 'block';
            } else {
                playIcon.style.display = 'block';
                pauseIcon.style.display = 'none';
            }
        }

        function updateActiveItem() {
            var items = document.querySelectorAll('.surah-item');
            for (var i = 0; i < items.length; i++) {
                items[i].classList.remove('active');
            }
            if (currentSurah) {
                var activeItem = document.querySelector('[data-surah="' + currentSurah.number + '"]');
                if (activeItem) {
                    activeItem.classList.add('active');
                }
            }
        }

        function downloadSurah(surah) {
            var url = getAudioUrl(surah.number);
            var a = document.createElement('a');
            a.href = url;
            a.download = surah.number + '-' + surah.english + '-' + qaris[currentQari].name + '.mp3';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        function renderSurahs(filteredSurahs) {
            var surahList = document.getElementById('surahList');
            surahList.innerHTML = '';

            for (var i = 0; i < filteredSurahs.length; i++) {
                var surah = filteredSurahs[i];
                var item = document.createElement('div');
                item.className = 'surah-item';
                item.setAttribute('data-surah', surah.number);
                item.setAttribute('data-index', i);
                
                item.innerHTML = '<div class="surah-info">' +
                    '<div class="surah-number">' + surah.number + '</div>' +
                    '<div class="surah-names">' +
                    '<h3>' + surah.arabic + '</h3>' +
                    '<p>' + surah.english + ' - ' + surah.verses + ' Verses</p>' +
                    '</div>' +
                    '</div>' +
                    '<div class="surah-actions">' +
                    '<button class="action-btn play-action" data-action="play" data-surah-num="' + surah.number + '">' +
                    '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>' +
                    '</button>' +
                    '<button class="action-btn download-action" data-action="download" data-surah-num="' + surah.number + '">' +
                    '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>' +
                    '</button>' +
                    '</div>';
                
                surahList.appendChild(item);
            }
        }

        qariSelect.addEventListener('change', function() {
            currentQari = qariSelect.value;
            if (currentSurah) {
                audio.src = getAudioUrl(currentSurah.number);
                if (isPlaying) {
                    audio.play();
                }
                updatePlayerUI(currentSurah);
            }
        });

        document.addEventListener('click', function(e) {
            var target = e.target;
            while (target && !target.hasAttribute('data-action')) {
                target = target.parentElement;
            }
            
            if (target) {
                var action = target.getAttribute('data-action');
                var surahNum = parseInt(target.getAttribute('data-surah-num'));
                var surah = surahs[surahNum - 1];
                
                if (action === 'play') {
                    playSurah(surah);
                } else if (action === 'download') {
                    downloadSurah(surah);
                }
            }
        });

        playBtn.addEventListener('click', togglePlay);
        prevBtn.addEventListener('click', playPrevious);
        nextBtn.addEventListener('click', playNext);

        audio.addEventListener('timeupdate', function() {
            if (audio.duration) {
                var progress = (audio.currentTime / audio.duration) * 100;
                progressBar.style.width = progress + '%';
                currentTimeEl.textContent = formatTime(audio.currentTime);
                durationEl.textContent = formatTime(audio.duration);
            }
        });

        audio.addEventListener('ended', function() {
            isPlaying = false;
            updatePlayButton();
            playNext();
        });

        audio.addEventListener('loadedmetadata', function() {
            durationEl.textContent = formatTime(audio.duration);
        });

        progressContainer.addEventListener('click', function(e) {
            var rect = progressContainer.getBoundingClientRect();
            var percent = (e.clientX - rect.left) / rect.width;
            audio.currentTime = percent * audio.duration;
        });

        searchInput.addEventListener('input', function(e) {
            var term = e.target.value.toLowerCase();
            var filtered = surahs.filter(function(surah) {
                return surah.arabic.includes(term) ||
                    surah.english.toLowerCase().includes(term) ||
                    surah.number.toString().includes(term);
            });
            renderSurahs(filtered);
        });

        renderSurahs(surahs);

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('service-worker.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registered');
                    })
                    .catch(function(err) {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>
</body>
</html>
